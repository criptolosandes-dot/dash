<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACADEMIA CRIPTO LOS ANDES | Conocimiento Puro</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root {
            --bg-black: #050505;
            --bg-glass: rgba(0, 0, 0, 0.75);
            --border-glass: rgba(255, 255, 255, 0.1);
            --accent-neon: #bfff00;
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --shadow-neon: 0 0 25px rgba(191, 255, 0, 0.15);
            --radius-xl: 30px;
            --radius-lg: 20px;
            --blur-val: 25px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #0b0e14;
            background-image: none;
            /* Imagen cargar√° despu√©s */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            color: var(--text-main);
            font-family: 'Urbanist', sans-serif;
            overflow-x: hidden;
            opacity: 1;
            /* Visible inmediatamente */
            transition: opacity 0.3s ease;
        }

        body.bg-loaded {
            background-image: url('bg-nodes.png');
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(7, 11, 20, 0.3);
            z-index: -1;
            pointer-events: none;
        }

        /* Access Restricted State */
        #access-denied {
            display: flex;
            height: 100vh;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            background: radial-gradient(circle at center, rgba(15, 20, 35, 0.4) 0%, rgba(5, 7, 10, 0.8) 100%);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 9999;
            transition: opacity 0.6s ease, visibility 0.6s;
        }

        #access-denied .glass-container {
            background: linear-gradient(135deg, rgba(23, 27, 49, 0.6) 0%, rgba(15, 20, 35, 0.4) 100%);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(191, 255, 0, 0.15);
            border-radius: 32px;
            padding: 3.5rem;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.8), 0 0 40px rgba(191, 255, 0, 0.05);
        }

        .lock-icon {
            font-size: 4rem;
            margin-bottom: 2rem;
            color: var(--accent-neon);
            animation: pulse 2s infinite;
            text-shadow: var(--shadow-neon);
        }

        /* Main Content Container */
        #main-content {
            display: none;
            max-width: 1100px;
            margin: 4rem auto;
            padding: 0 4rem;
            min-height: 100vh;
        }

        .glass-container {
            background: var(--bg-glass);
            backdrop-filter: blur(var(--blur-val));
            -webkit-backdrop-filter: blur(var(--blur-val));
            border: 1px solid var(--border-glass);
            border-radius: var(--radius-xl);
            padding: 3rem;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
        }

        /* Header */
        header {
            text-align: center;
            padding-bottom: 2rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-glass);
            position: relative;
        }

        h1 {
            font-weight: 700;
            font-size: clamp(1.8rem, 8vw, 3.5rem);
            letter-spacing: -2px;
            margin-bottom: 0.5rem;
            line-height: 1;
            text-transform: uppercase;
        }

        h1 span {
            color: var(--accent-neon);
            text-shadow: 0 0 20px rgba(191, 255, 0, 0.3);
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 1rem;
            font-weight: 300;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin-top: 1rem;
        }

        .back-link {
            text-decoration: none;
            color: var(--text-muted);
            font-size: 0.85rem;
            position: absolute;
            top: -1rem;
            left: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            border-color: var(--accent-neon);
            color: var(--accent-neon);
            background: rgba(191, 255, 0, 0.05);
        }

        /* TAB NAVIGATION */
        .category-tabs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 3rem;
            background: rgba(255, 255, 255, 0.02);
            padding: 10px;
            border-radius: 50px;
            border: 1px solid var(--border-glass);
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 16px;
            border-radius: 40px;
            font-family: 'Urbanist', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            text-align: center;
        }

        .tab-btn:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab-btn.active {
            background: var(--accent-neon);
            color: var(--bg-black);
            box-shadow: 0 0 25px rgba(191, 255, 0, 0.3);
        }

        /* Categories */
        .category-badge {
            display: inline-block;
            font-size: 0.7rem;
            font-weight: 800;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            padding: 6px 12px;
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .cat-fundamentos {
            border: 1px solid var(--accent-neon);
            color: var(--accent-neon);
            background: rgba(191, 255, 0, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .cat-tutoriales {
            border: 1px solid #ffffff;
            color: #ffffff;
            background: rgba(255, 255, 255, 0.05);
        }

        /* Course Sections */
        .module-list {
            display: flex;
            flex-direction: column;
            gap: 5rem;
            transition: opacity 0.3s ease;
        }

        .module-list.fading {
            opacity: 0;
        }

        .module-item {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            opacity: 1;
            transform: translateY(0);
            animation: slideUp 0.6s both;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 4rem;
        }

        /* PC Layout: Cyber-Luxury Zig-Zag */
        @media (min-width: 850px) {
            .module-item {
                flex-direction: row;
                align-items: center;
                gap: 4rem;
                text-align: left;
                padding-bottom: 8rem;
            }

            .module-content {
                flex: 0.8;
                padding: 0 2rem;
            }

            .video-card {
                flex: 1.2;
                max-width: 100%;
            }

            .module-item.reverse {
                flex-direction: row-reverse;
            }
        }

        /* Mobile Layout */
        @media (max-width: 849px) {
            .module-item {
                flex-direction: column;
                align-items: center;
                text-align: center;
                gap: 2rem;
                padding-bottom: 4rem;
            }

            .module-content {
                width: 100%;
            }

            .video-card {
                width: 100%;
            }
        }

        .module-item:last-child {
            border-bottom: none;
        }

        .module-item.hidden {
            display: none !important;
        }

        .module-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-main);
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .module-desc {
            color: var(--text-muted);
            font-size: 1.05rem;
            line-height: 1.7;
            font-weight: 300;
            max-width: 95%;
        }

        .video-card {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--border-glass);
            border-radius: 30px;
            padding: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        .video-card:hover {
            border-color: var(--accent-neon);
            box-shadow: 0 0 30px rgba(191, 255, 0, 0.1);
        }

        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            border-radius: 22px;
            overflow: hidden;
            background: #000;
        }

        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .whatsapp-float {
            position: fixed;
            bottom: 40px;
            right: 40px;
            background-color: #25d366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            font-size: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .whatsapp-float:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(37, 211, 102, 0.5);
        }

        .whatsapp-icon {
            width: 32px;
            height: 32px;
            fill: white;
        }

        footer {
            text-align: center;
            padding: 4rem 0 2rem;
            color: var(--text-muted);
            font-size: 0.8rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .btn {
            background: var(--accent-neon);
            color: var(--bg-black);
            border: none;
            padding: 16px;
            border-radius: 15px;
            font-family: 'Urbanist', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            box-shadow: 0 0 20px rgba(191, 255, 0, 0.2);
            transition: all 0.3s ease;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(191, 255, 0, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        @media (max-width: 768px) {
            #main-content {
                padding: 1rem 1.25rem;
                width: 100%;
                margin-top: 2rem;
            }

            .glass-container {
                padding: 1.5rem;
            }

            .whatsapp-float {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 0.8;
            }

            50% {
                transform: scale(1.05);
                opacity: 1;
            }

            100% {
                transform: scale(1);
                opacity: 0.8;
            }
        }
    </style>
</head>

<body>

    <!-- Access Denied View -->
    <div id="access-denied">
        <div class="glass-container" style="text-align: center; max-width: 450px;">
            <div class="lock-icon">üîí</div>
            <h2>ACCESO RESTRINGIDO</h2>
            <p
                style="color: var(--text-muted); margin-bottom: 2rem; font-size: 0.95rem; line-height: 1.6; font-weight: 300;">
                Este es un entorno de conocimiento soberano.<br>Requiere validaci√≥n de llave criptogr√°fica.
            </p>

            <div style="margin-bottom: 2rem;">
                <input type="password" id="pass-input" placeholder="INGRESE LLAVE DE ACCESO"
                    style="width: 100%; padding: 16px; background: rgba(255,255,255,0.03); border: 1px solid var(--border-glass); border-radius: 15px; color: #fff; text-align: center; font-family: 'Urbanist', sans-serif; font-size: 1rem; letter-spacing: 4px; margin-bottom: 1.5rem; outline: none; transition: all 0.3s ease;">

                <button onclick="verificarToken()" class="btn" style="width: 100%; cursor: pointer;">VALIDAR
                    ACCESO</button>
            </div>

            <a href="https://wa.me/593978858638?text=Hola%20Cripto%20Los%20Andes,%20necesito%20mi%20llave%20de%20acceso"
                target="_blank"
                style="color: var(--accent-neon); text-decoration: none; font-size: 0.8rem; font-weight: 600; letter-spacing: 1px; display: block; margin-bottom: 2rem;">SOLICITAR
                LLAVE</a>

            <a href="/dash/"
                style="color: var(--text-muted); text-decoration: none; font-size: 0.75rem; letter-spacing: 2px;">
                ‚Üê RETORNAR AL DASHBOARD
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content">
        <div class="glass-container">
            <header>
                <a href="/dash/" class="back-link"><span>‚Üê</span> VOLVER AL INICIO</a>
                <h1>CRIPTO <span>LOS ANDES</span></h1>
                <div class="subtitle">ACADEMIA DE CONOCIMIENTO PURO</div>
            </header>

            <div class="category-tabs">
                <button class="tab-btn active" onclick="filterModules('all')">TODO</button>
                <button class="tab-btn" onclick="filterModules('fundamentos')">FUNDAMENTOS</button>
                <button class="tab-btn" onclick="filterModules('tutoriales')">TUTORIALES</button>
            </div>

            <div class="module-list" id="module-container">
                <!-- Modules will be filtered here -->
                <section class="module-item" data-category="fundamentos">
                    <div class="module-content">
                        <span class="category-badge cat-fundamentos">FUNDAMENTOS</span>
                        <h2 class="module-title">El Espejismo de la Deuda Infinita</h2>
                        <p class="module-desc">El sistema fiduciario no es dinero, es deuda. Analizamos c√≥mo la
                            inflaci√≥n funciona como un impuesto invisible que confisca tu tiempo y energ√≠a vital.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/aaAvHic3UOs" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="fundamentos">
                    <div class="module-content">
                        <span class="category-badge cat-fundamentos">FUNDAMENTOS</span>
                        <h2 class="module-title">G√©nesis del Consenso Distribuido</h2>
                        <p class="module-desc">Bitcoin no es una empresa, es un protocolo. Desglosamos la arquitectura
                            de una red que opera mediante reglas matem√°ticas estrictas.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/Ow376vKIBXE" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="fundamentos">
                    <div class="module-content">
                        <span class="category-badge cat-fundamentos">FUNDAMENTOS</span>
                        <h2 class="module-title">El Registro de la Verdad Inmutable</h2>
                        <p class="module-desc">La Blockchain ofrece certeza. Cada bloque es un monumento criptogr√°fico
                            al pasado, haciendo que la verdad sea indestructible.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/8rUGRdOi3XM" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="fundamentos">
                    <div class="module-content">
                        <span class="category-badge cat-fundamentos">FUNDAMENTOS</span>
                        <h2 class="module-title">La Resoluci√≥n del Dilema Bizantino</h2>
                        <p class="module-desc">¬øC√≥mo confiar en una red donde cualquiera podr√≠a ser un adversario? La
                            combinaci√≥n de Proof of Work y Teor√≠a de Juegos.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/w4vagQvF-I0" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="fundamentos">
                    <div class="module-content">
                        <span class="category-badge cat-fundamentos">FUNDAMENTOS</span>
                        <h2 class="module-title">Axiomas de la Criptograf√≠a Aplicada</h2>
                        <p class="module-desc">Donde la ley humana falla, las matem√°ticas prevalecen. Exploramos c√≥mo la
                            criptograf√≠a asim√©trica protege la propiedad privada.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/2fRYPDS_jrM" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="tutoriales">
                    <div class="module-content">
                        <span class="category-badge cat-tutoriales">TUTORIALES</span>
                        <h2 class="module-title">Binance: C√≥mo Crear una Cuenta</h2>
                        <p class="module-desc">Aprende a establecer tu identidad en el ciberespacio para interactuar con
                            la econom√≠a del futuro de forma segura.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/-UtQjXVVrcA" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="tutoriales">
                    <div class="module-content">
                        <span class="category-badge cat-tutoriales">TUTORIALES</span>
                        <h2 class="module-title">C√≥mo Comprar Cripto: El Puente</h2>
                        <p class="module-desc">Aprende el proceso t√©cnico para transmutar moneda local en activos
                            inmutables.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/ZclJzW1q6AQ" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="tutoriales">
                    <div class="module-content">
                        <span class="category-badge cat-tutoriales">TUTORIALES</span>
                        <h2 class="module-title">Binance P2P: Comerciar Entre Pares</h2>
                        <p class="module-desc">Aprende a intercambiar valor directamente con otros soberanos manteniendo
                            tu privacidad financiera.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/NS-Or-801G4" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="tutoriales">
                    <div class="module-content">
                        <span class="category-badge cat-tutoriales">TUTORIALES</span>
                        <h2 class="module-title">Binance Pay: Pagar y Enviar Capital</h2>
                        <p class="module-desc">Utiliza la infraestructura de Binance Pay para movilizar tu energ√≠a vital
                            a trav√©s de las fronteras.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/bFC4NzGoFfE" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="tutoriales">
                    <div class="module-content">
                        <span class="category-badge cat-tutoriales">TUTORIALES</span>
                        <h2 class="module-title">Custodia Propia: Billetera Soberana</h2>
                        <p class="module-desc">"Not your keys, not your coins". Aprende a retirar tus activos del
                            exchange.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/xTG2XapXDvk" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="fundamentos">
                    <div class="module-content">
                        <span class="category-badge cat-fundamentos">FUNDAMENTOS</span>
                        <h2 class="module-title">Ethereum y Contratos Inteligentes</h2>
                        <p class="module-desc">Sentando las bases de una nueva civilizaci√≥n digital mediante la
                            computaci√≥n programable.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/BHpyGy2X1t4" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="fundamentos">
                    <div class="module-content">
                        <span class="category-badge cat-fundamentos">FUNDAMENTOS</span>
                        <h2 class="module-title">Anatom√≠a de la Soberan√≠a</h2>
                        <p class="module-desc">La llave privada es el √∫nico puente entre tu voluntad y tu propiedad.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/Kg0tfe6qOtc" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="fundamentos">
                    <div class="module-content">
                        <span class="category-badge cat-fundamentos">FUNDAMENTOS</span>
                        <h2 class="module-title">Estabilidad Fiduciaria vs Cripto</h2>
                        <p class="module-desc">C√≥mo las stablecoins act√∫an como puentes de liquidez en un entorno
                            vol√°til.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/bVZGmjbOKRw" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="fundamentos">
                    <div class="module-content">
                        <span class="category-badge cat-fundamentos">FUNDAMENTOS</span>
                        <h2 class="module-title">Lightning Network: Velocidad</h2>
                        <p class="module-desc">Analizamos lightning como la capa de energ√≠a cinem√°tica que permite pagos
                            instant√°neos.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/lD8WQbS8-T8" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>

                <section class="module-item" data-category="tutoriales">
                    <div class="module-content">
                        <span class="category-badge cat-tutoriales">TUTORIALES</span>
                        <h2 class="module-title">Tutorial: Billetera Phoenix</h2>
                        <p class="module-desc">Soberan√≠a m√≥vil en la palma de tu mano con la red Lightning.</p>
                    </div>
                    <div class="video-card">
                        <div class="video-wrapper">
                            <iframe src="https://www.youtube.com/embed/VPJAU7d2QUg" allowfullscreen></iframe>
                        </div>
                    </div>
                </section>
            </div>

            <footer>&copy; 2026 CRIPTO LOS ANDES | SOBERAN√çA INDIVIDUAL</footer>
        </div>
    </main>

    <a href="https://wa.me/593978858638" class="whatsapp-float" target="_blank">
        <svg class="whatsapp-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
            <path
                d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z" />
        </svg>
    </a>

    <script>
        // --- CARGA OPTIMIZADA DE IMAGEN DE FONDO ---
        window.addEventListener('DOMContentLoaded', function () {
            // Cargar imagen de fondo despu√©s de que la p√°gina sea interactiva
            const bgImage = new Image();
            bgImage.onload = function () {
                document.body.classList.add('bg-loaded');
            };
            bgImage.src = 'bg-nodes.png';
        });

        // --- CONFIGURACI√ìN SUPABASE ---
        const SB_URL = "https://usqrulkrvgipxokokvhb.supabase.co";
        const SB_KEY = "sb_publishable_Kw9Y4g07wh416I1sOklJRQ_j9s0acIT";
        const sbClient = supabase.createClient(SB_URL, SB_KEY);

        // --- SISTEMA DE HUELLA DIGITAL (FINGERPRINTING) ---
        async function obtenerDeviceId() {
            let id = localStorage.getItem('ANDES_DEVICE_ID');
            if (!id) {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const txt = 'CriptoLosAndes-Soberania';
                ctx.textBaseline = "alphabetic";
                ctx.fillStyle = "#f60";
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = "#069";
                ctx.fillText(txt, 2, 15);
                ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
                ctx.fillText(txt, 4, 17);
                const fingerprint = canvas.toDataURL().slice(-50);
                id = btoa(navigator.userAgent + screen.width + fingerprint).slice(0, 32);
                localStorage.setItem('ANDES_DEVICE_ID', id);
            }
            return id;
        }

        (function () {
            const accessDenied = document.getElementById('access-denied');
            const mainContent = document.getElementById('main-content');
            if (accessDenied) accessDenied.style.display = "flex";
            if (mainContent) mainContent.style.display = "none";
        })();

        window.onload = function () {
            const input = document.getElementById('pass-input');
            if (input) {
                input.focus();
                input.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') verificarToken();
                });
            }
            filterModules('all');
        };

        async function verificarToken() {
            const input = document.getElementById('pass-input');
            const btn = document.querySelector('.btn');
            const tokenIngresado = input.value.trim().toUpperCase();

            if (!tokenIngresado) return;

            btn.disabled = true;
            btn.innerText = "VERIFICANDO...";
            input.disabled = true;

            try {
                const deviceId = await obtenerDeviceId();

                // 1. Consultar el token en Supabase
                const { data, error } = await sbClient
                    .from('llaves_acceso')
                    .select('*')
                    .eq('token', tokenIngresado)
                    .single();

                if (error || !data) throw new Error('TOKEN_INVALIDO');
                if (!data.esta_activa) throw new Error('TOKEN_DESACTIVADO');

                // 2. Obtener lista de dispositivos autorizados
                const dispositivosAutorizados = data.dispositivos_autorizados || [];

                // 3. Verificar si el dispositivo actual est√° autorizado
                if (dispositivosAutorizados.includes(deviceId)) {
                    // ‚úÖ Dispositivo ya autorizado
                    await sbClient
                        .from('llaves_acceso')
                        .update({ ultimo_acceso: new Date().toISOString() })
                        .eq('token', tokenIngresado);

                    unlockAccess();
                    return;
                }

                // 4. Nuevo dispositivo detectado
                if (dispositivosAutorizados.length < 2) {
                    // ‚úÖ Espacio disponible: agregar dispositivo
                    const nuevosDispositivos = [...dispositivosAutorizados, deviceId];
                    await sbClient
                        .from('llaves_acceso')
                        .update({
                            dispositivos_autorizados: nuevosDispositivos,
                            ultimo_acceso: new Date().toISOString()
                        })
                        .eq('token', tokenIngresado);

                    console.log(`üì± Dispositivo ${dispositivosAutorizados.length + 1}/2 autorizado`);
                    unlockAccess();
                    return;
                }

                // 5. ‚ùå TERCER DISPOSITIVO DETECTADO ‚Üí BAN INMEDIATO
                await sbClient
                    .from('llaves_acceso')
                    .update({ esta_activa: false })
                    .eq('token', tokenIngresado);

                throw new Error('TOKEN_BANEADO');

            } catch (err) {
                console.error("‚ùå Error verificando token:", err);

                let errorMsg = "TOKEN INV√ÅLIDO";
                let debugMsg = "";

                if (err.message === 'TOKEN_BANEADO') errorMsg = "‚õî LLAVE BANEADA POR COMPARTIR";
                else if (err.message === 'TOKEN_DESACTIVADO') errorMsg = "LLAVE DESACTIVADA";
                else if (err.message === 'TOKEN_YA_VINCULADO') errorMsg = "VINCULADO A OTRO DISPOSITIVO";
                else if (err.message === 'TOKEN_INVALIDO') errorMsg = "TOKEN NO ENCONTRADO";
                else {
                    // Error desconocido (red, permisos, etc)
                    debugMsg = err.message;
                    errorMsg = "ERROR DE CONEXI√ìN";
                }

                input.style.borderColor = "#ff0000";
                input.style.boxShadow = "0 0 25px rgba(255, 0, 0, 0.4)";
                input.style.color = "#ff0000";
                input.value = "";
                input.placeholder = errorMsg;

                if (debugMsg) alert("Debug Error: " + debugMsg); // Temporal para ver el error real en m√≥vil

                setTimeout(() => {
                    input.style.borderColor = "var(--border-glass)";
                    input.style.boxShadow = "none";
                    input.style.color = "#fff";
                    input.placeholder = "INGRESE LLAVE DE ACCESO";
                    btn.disabled = false;
                    btn.innerText = "VALIDAR ACCESO";
                    input.disabled = false;
                }, 2000);
            }
        }

        function unlockAccess() {
            localStorage.setItem('ANDES_SESSION_ACTIVE', 'true');
            document.getElementById('main-content').style.display = "block";
            document.getElementById('access-denied').style.opacity = "0";
            setTimeout(() => {
                document.getElementById('access-denied').style.display = "none";
            }, 600);
        }

        function filterModules(category) {
            const container = document.getElementById('module-container');
            const modules = document.querySelectorAll('.module-item');
            const buttons = document.querySelectorAll('.tab-btn');

            buttons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.innerText.toLowerCase() === category.toLowerCase() || (category === 'all' && btn.innerText === 'TODO')) {
                    btn.classList.add('active');
                }
            });

            container.classList.add('fading');

            setTimeout(() => {
                let visibleCount = 0;
                modules.forEach(module => {
                    if (category === 'all' || module.dataset.category === category) {
                        module.classList.remove('hidden');
                        visibleCount++;
                        module.classList.toggle('reverse', visibleCount % 2 === 0);
                        module.style.animation = 'none';
                        module.offsetHeight;
                        module.style.animation = 'slideUp 0.6s forwards';
                    } else {
                        module.classList.add('hidden');
                    }
                });
                container.classList.remove('fading');
            }, 300);
        }
    </script>
</body>

</html>